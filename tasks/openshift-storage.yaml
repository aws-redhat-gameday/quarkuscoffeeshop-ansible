---
- name: deploy the openshift storage operator
  k8s:
    state: present
    namespace: "openshift-storage"
    definition: "{{ lookup('template', 'openshift-storage-operator.yaml.j2') }}"

- name: Waiting for openshift storage operator
  k8s_info:
    kind: Pod
    label_selectors:
      - name = ocs-operator
    field_selectors:
      - status.phase=Running
  register: r_storage_status
  retries: 120
  delay: 15
  until: r_storage_status.resources | list | length == 1

- name: displaying openshift storage operator  deployment status
  debug:
    var: r_storage_status.resources[0].status.phase
  ignore_errors: false

- name: deploy the quay-datastore noobaa
  k8s:
    state: present
    namespace: "openshift-storage"
    definition: "{{ lookup('file', 'quay-datastore.noobaa.yaml') }}"